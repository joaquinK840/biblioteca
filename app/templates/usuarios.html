<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- ============================================
          LIBRARY - User Management
          Full user CRUD
          ============================================ -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Usuarios - Biblioteca</title>
    <link rel="stylesheet" href="/static/css/styles.css" />
    <script src="/static/js/main.js"></script>
  </head>
  <body>
    <!-- ========== HEADER ========== -->
    <header>
      <h1>ğŸ‘¤ GestiÃ³n de Usuarios</h1>
      <p>AdministraciÃ³n de usuarios del sistema</p>
    </header>

    <!-- ========== NAVIGATION ========== -->
    <nav>
      <a href="/">ğŸ  Inicio</a>
      <a href="/templates/libros">ğŸ“– Libros</a>
      <a href="/templates/usuarios" class="active">ğŸ‘¤ Usuarios</a>
      <a href="/templates/prestamos">ğŸ“‹ PrÃ©stamos</a>
      <a href="/templates/reservas">ğŸ”– Reservas</a>
      <a href="/templates/estanterias">ğŸ“š EstanterÃ­as</a>
    </nav>

    <!-- ========== MAIN CONTENT ========== -->
    <div class="container">
      <!-- ===== SECTION: Users List ===== -->
      <div class="section fade-in">
        <h2>ğŸ“‹ Lista de Usuarios</h2>

        <div class="form-group">
          <button onclick="cargarUsuarios()">ğŸ”„ Cargar Usuarios</button>
        </div>

        <!-- Users table -->
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Correo</th>
                <th>TelÃ©fono</th>
              </tr>
            </thead>
            <tbody id="tabla-usuarios">
              <!-- Los datos se cargan dinÃ¡micamente -->
            </tbody>
          </table>
        </div>

        <!-- Loading indicator -->
        <div id="loading-usuarios" class="loading">Cargando...</div>
      </div>

      <!-- ===== SECTION: Create User ===== -->
      <div class="section fade-in">
        <h2>â• Crear Nuevo Usuario</h2>

        <div class="form-group">
          <input type="text" id="uid" placeholder="ID del usuario" />
          <input type="text" id="nombre" placeholder="Nombre completo" />
        </div>

        <div class="form-group">
          <input type="email" id="correo" placeholder="Correo electrÃ³nico" />
          <input type="tel" id="telefono" placeholder="TelÃ©fono" />
        </div>

        <button onclick="crearUsuario()" class="btn-success">
          âœ… Crear Usuario
        </button>
      </div>
    </div>

    <!-- ========== FOOTER ========== -->
    <footer>
      <p>Sistema de GestiÃ³n de Biblioteca Â© 2025</p>
    </footer>

    <!-- ========== SCRIPTS ========== -->
    <script>
      // API base URL
      const API_BASE = "http://127.0.0.1:8000";

      /**
       * Load all users from the API
       * Uses: GET /usuarios/
       */
      async function cargarUsuarios() {
        mostrarLoading("loading-usuarios", true);
        try {
          const datos = await fetchAPI(`${API_BASE}/usuarios/`);
          renderTablaUsuarios(datos);
        } catch (error) {
          mostrarError("Error al cargar usuarios");
        }
        mostrarLoading("loading-usuarios", false);
      }

      /**
       * Create a new user
       * Uses: POST /usuarios/
       */
      async function crearUsuario() {
        const data = {
          user_id: document.getElementById("uid").value.trim(),
          nombre: document.getElementById("nombre").value.trim(),
          correo: document.getElementById("correo").value.trim(),
          telefono: document.getElementById("telefono").value.trim(),
        };

        // ValidaciÃ³n bÃ¡sica
        if (!data.user_id || !data.nombre || !data.correo) {
          mostrarError("ID, Nombre y Correo son obligatorios");
          return;
        }

        try {
          await fetchAPI(`${API_BASE}/usuarios/`, "POST", data);
          mostrarExito("Usuario creado exitosamente");
          limpiarFormulario();
          cargarUsuarios();
        } catch (error) {
          mostrarError("Error al crear usuario (Â¿ID duplicado?)");
        }
      }

      // ========== HELPER FUNCTIONS ==========

      /**
       * Render the users table
       */
      function renderTablaUsuarios(usuarios) {
        const tabla = document.getElementById("tabla-usuarios");
        tabla.innerHTML = "";

        usuarios.forEach((usuario) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
                    <td>${usuario.user_id}</td>
                    <td>${usuario.nombre}</td>
                    <td>${usuario.correo}</td>
                    <td>${usuario.telefono || "-"}</td>
                `;
          tabla.appendChild(tr);
        });
      }

      function limpiarFormulario() {
        ["uid", "nombre", "correo", "telefono"].forEach((id) => {
          document.getElementById(id).value = "";
        });
      }

      function mostrarLoading(id, show) {
        const el = document.getElementById(id);
        if (el) el.classList.toggle("active", show);
      }

      function mostrarExito(msg) {
        alert("âœ… " + msg);
      }

      function mostrarError(msg) {
        alert("âŒ " + msg);
      }

      // Load users on page start
      document.addEventListener("DOMContentLoaded", cargarUsuarios);
    </script>
  </body>
</html>
